<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Emotion Tracking Study</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #333;
    }

    .container {
      max-width: 800px;
      width: 90%;
      background: white;
      border-radius: 15px;
      box-shadow: 0 15px 35px rgba(0,0,0,0.1);
      overflow: hidden;
      margin: 20px;
    }

    .header {
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      color: white;
      padding: 30px 20px;
      text-align: center;
    }

    .header h1 {
      font-size: 2rem;
      margin-bottom: 10px;
      font-weight: 300;
    }

    .header p {
      font-size: 1.1rem;
      opacity: 0.9;
    }

    .content {
      padding: 30px 20px;
      text-align: center;
    }

    .step {
      display: none;
      animation: fadeIn 0.5s ease-in;
    }

    .step.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .btn {
      background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.1rem;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 10px;
      box-shadow: 0 5px 15px rgba(76,175,80,0.3);
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(76,175,80,0.4);
    }

    .btn:active {
      transform: translateY(0);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    #videoPlayer {
      width: 100%;
      max-width: 600px;
      height: auto;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      display: none;
      margin: 20px 0;
    }

    /* Hide video controls completely */
    #videoPlayer::-webkit-media-controls {
      display: none !important;
    }

    #videoPlayer::-webkit-media-controls-panel {
      display: none !important;
    }

    #videoPlayer::-webkit-media-controls-play-button {
      display: none !important;
    }

    #videoPlayer::-webkit-media-controls-start-playback-button {
      display: none !important;
    }

    #videoPlayer::-webkit-media-controls-timeline {
      display: none !important;
    }

    #videoPlayer::-webkit-media-controls-current-time-display {
      display: none !important;
    }

    #videoPlayer::-webkit-media-controls-time-remaining-display {
      display: none !important;
    }

    #videoPlayer::-webkit-media-controls-volume-slider {
      display: none !important;
    }

    #videoPlayer::-webkit-media-controls-mute-button {
      display: none !important;
    }

    #videoPlayer::-webkit-media-controls-fullscreen-button {
      display: none !important;
    }

    .completion-code {
      background: #f8f9fa;
      border: 2px solid #4CAF50;
      border-radius: 10px;
      padding: 20px;
      margin: 20px 0;
      font-size: 1.5rem;
      font-weight: bold;
      color: #4CAF50;
      letter-spacing: 2px;
    }

    .privacy-link {
      color: #4CAF50;
      text-decoration: none;
      font-weight: 500;
    }

    .privacy-link:hover {
      text-decoration: underline;
    }

    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #4CAF50;
      border-radius: 50%;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 20px auto;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .error-message {
      background: #ffebee;
      border: 1px solid #f44336;
      color: #c62828;
      padding: 15px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .instructions {
      text-align: left;
      background: #f8f9fa;
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
    }

    .instructions h3 {
      color: #4CAF50;
      margin-bottom: 10px;
    }

    .instructions ul {
      margin-left: 20px;
    }

    .instructions li {
      margin: 5px 0;
    }

    /* Mobile specific styles */
    @media (max-width: 768px) {
      .container {
        width: 95%;
        margin: 10px;
      }

      .header h1 {
        font-size: 1.5rem;
      }

      .header p {
        font-size: 1rem;
      }

      .content {
        padding: 20px 15px;
      }

      .btn {
        padding: 12px 25px;
        font-size: 1rem;
      }

      #videoPlayer {
        max-width: 100%;
      }
    }

    /* Fullscreen video styles */
    #videoPlayer:-webkit-full-screen {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    #videoPlayer:-moz-full-screen {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    #videoPlayer:fullscreen {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* Progress indicator */
    .progress-bar {
      width: 100%;
      height: 4px;
      background: #e0e0e0;
      border-radius: 2px;
      overflow: hidden;
      margin: 20px 0;
    }

    .progress-fill {
      height: 100%;
      background: #4CAF50;
      transition: width 0.3s ease;
      width: 0%;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Emotion Tracking Study</h1>
      <p>Help us understand emotional responses to video content</p>
    </div>

    <div class="content">
      <!-- Step 1: Camera Permission -->
      <div class="step active" id="step1">
        <h2>Step 1: Camera Access</h2>
        <div class="instructions">
          <h3>Before we begin:</h3>
          <ul>
            <li>We need access to your camera to track your facial expressions</li>
            <li>Your video data is processed locally and not stored</li>
            <li>Only anonymous emotion data is collected</li>
            <li>The study takes approximately 24 seconds</li>
          </ul>
        </div>
        <p>
          <a href="#" class="privacy-link" id="privacyLink">Read our Privacy Policy</a>
        </p>
        <button class="btn" id="allowCameraBtn">Allow Camera Access</button>
      </div>

      <!-- Step 2: Ready to Watch -->
      <div class="step" id="step2">
        <h2>Step 2: Watch the Video</h2>
        <p>Please watch the entire video in fullscreen mode.</p>
        <p><strong>Important:</strong> Keep your face visible to the camera during the video.</p>
        <button class="btn" id="startVideoBtn">Start Video</button>
      </div>

      <!-- Step 3: Video Playing -->
      <div class="step" id="step3">
        <h2>Now Playing</h2>
        <video id="videoPlayer" preload="auto" playsinline>
          <source id="videoSource" src="" type="video/mp4">
          Your browser does not support the video tag.
        </video>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
        <p>Please keep your face visible and watch until the end.</p>
      </div>

      <!-- Step 4: Processing -->
      <div class="step" id="step4">
        <h2>Processing Your Data</h2>
        <div class="loading-spinner"></div>
        <p>Please wait while we process and upload your response data...</p>
      </div>

      <!-- Step 5: Completion -->
      <div class="step" id="step5">
        <h2>Thank You!</h2>
        <p>Your participation has been recorded. Here is your completion code:</p>
        <div class="completion-code" id="completionCode">
          COMPLETION_CODE_PLACEHOLDER
        </div>
        <button class="btn" id="copyCodeBtn">Copy Code</button>
        <p style="margin-top: 20px; font-size: 0.9rem; color: #666;">
          Please copy this code and paste it in your task to complete the study.
        </p>
      </div>

      <!-- Error Step -->
      <div class="step" id="errorStep">
        <h2>Error</h2>
        <div class="error-message" id="errorMessage">
          An error occurred. Please refresh the page and try again.
        </div>
        <button class="btn" id="retryBtn">Retry</button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://unpkg.com/@supabase/supabase-js@2.39.3/dist/umd/supabase.js"></script>
  <script src="https://ai-sdk.morphcast.com/v1.16/ai-sdk.js?v4"></script>

  <!-- Configuration (inline to avoid ES6 module issues with file://) -->
  <script>
    console.log('ðŸ”§ Loading Emotion Tracking V2 Configuration...');

    const config = {
      // Video Configuration
      VIDEO_URL: "https://assets.homa-cloud.com/cm0wqgm1d002gdslcdl3hq3yl/f4bea092-1f69-4f99-8d7a-fc8fb52ac610/CAY_R91_V1_WW_VID_1080x1920_24s.mp4",
      
      // Task Configuration
      TASK_ID: "TASK-1",
      COMPLETION_CODE: "EMOTION123",
      PRIVACY_POLICY_URL: "https://example.com/privacy",
      
      // Supabase Configuration
      SUPABASE_URL: "https://xpzyupzfgzfvmjttfqcs.supabase.co",
      SUPABASE_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inhwenl1cHpmZ3pmdm1qdHRmcWNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mjc3NzEyNzMsImV4cCI6MjA0MzM0NzI3M30.6hGJjRPnG1pGH8dZCkfgTOWa5O2WfUJFSKjOiZGJZZU",
      
      // Morphcast Configuration
      MORPHCAST_LICENSE: "ap95c1923492e8512306644ca7fea0e66e7c27a47b97bb",
      
      // Timeline Configuration (in seconds)
      TIMELINE_DURATION: 30,
      TIMELINE_INTERVAL: 1,
      
      // Debug Configuration
      DEBUG_MODE: true,
      CONSOLE_LOGGING: true
    };

    console.log('âœ… Configuration loaded successfully:', config);
    console.log('ðŸ“¹ Video URL:', config.VIDEO_URL);
    console.log('ðŸ”‘ Morphcast License:', config.MORPHCAST_LICENSE ? 'Present' : 'Missing');
    console.log('ðŸ’¾ Supabase URL:', config.SUPABASE_URL ? 'Present' : 'Missing');
  </script>

  <!-- Main Application (simplified to use regular scripts instead of ES6 modules) -->
  <script src="app-simplified.js"></script>
</body>
</html> 